// Generated by CoffeeScript 1.5.0

$(document).ready(function() {
  var food, start, user;
  user = void 0;
  food = void 0;
  $(".radio_on_map").change(function() {
    if (user === void 0) {
      user = $(this).val();
      $('#' + user.replace(':', '_')).append('<div id="agent" />');
      return $(this).hide();
    } else {
      food = $(this).val();
      $(".radio_on_map").hide();
      $('#' + food.replace(':', '_')).append('<div id="food" />');
      return start(user, food);
    }
  });
  return start = function(user, food) {
    return $.ajax({
      type: "POST",
      url: "?request=astar/calculateSteps",
      data: {
        'map': jsonMap,
        'user': user,
        'food': food
      },
      success: function(data) {
        var ghost, i, map, onFire, walkRoute, walker,
          _this = this;
        walkRoute = JSON.parse(data);
        map = JSON.parse(jsonMap);
        i = 0;
        onFire = false;
        ghost = false;
        walker = function() {
          $('#agent').remove();
          $('#' + walkRoute[i].replace(':', '_')).append('<div id="agent" />');
          if (onFire && !ghost) {
            $('#agent').css('background-position', '-288px');
          }
          if (ghost) {
            $('#agent').css('background-position', '-320px');
          }
          if (food === walkRoute[i]) {
            $('#food').remove();
          }
          if (map[walkRoute[i]] === "1" && !ghost) {
            onFire = true;
            $('#agent').css('background-position', '-288px');
          }
          if (map[walkRoute[i]] === "2" && onFire) {
            ghost = true;
            $('#agent').css('background-position', '-320px');
          }
          i++;
          if (i < walkRoute.length) {
            return setTimeout(walker, 500);
          }
        };
        return setTimeout(walker, 500);
      }
    });
  };
});
